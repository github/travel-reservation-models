<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Reservations</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- VueJS via CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        /* Basic styling */
        body { font-family: sans-serif; }
        .container { max-width: 1024px; margin: auto; padding: 20px; }
        [v-cloak] { display: none; } /* Hide uncompiled Vue templates */
    </style>
</head>
<body class="bg-gray-100">
    <div id="app" class="container" v-cloak>
        <h1 class="text-3xl font-bold mb-6 text-center text-blue-700">Hotel Reservation System</h1>

        <!-- Room Listing -->
        <section class="mb-8 bg-white p-6 rounded shadow">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Available Rooms</h2>
            <div v-if="loadingRooms" class="text-center text-gray-500">Loading rooms...</div>
            <div v-else-if="rooms.length === 0" class="text-center text-gray-500">No rooms available.</div>
            <ul v-else class="space-y-2">
                <li v-for="room in rooms" :key="room.id" class="p-3 border rounded bg-gray-50">
                    <span class="font-medium">{% raw %}{{ room.name }}{% endraw %}</span> - Availability: {% raw %}{{ room.availability }}{% endraw %}
                </li>
            </ul>
            <div v-if="errorRooms" class="text-red-500 mt-2">{{ errorRooms }}</div>
        </section>

        <!-- Reservation Form -->
        <section class="mb-8 bg-white p-6 rounded shadow">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Make a Reservation</h2>
            <form @submit.prevent="makeReservation" class="space-y-4">
                <div>
                    <label for="guestName" class="block text-sm font-medium text-gray-700">Guest Name:</label>
                    <input type="text" id="guestName" v-model="newReservation.guestName" required
                           class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>
                <div>
                    <label for="roomId" class="block text-sm font-medium text-gray-700">Room:</label>
                    <select id="roomId" v-model.number="newReservation.roomId" required
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        <option disabled value="">Please select a room</option>
                        <option v-for="room in rooms" :key="room.id" :value="room.id">{% raw %}{{ room.name }}{% endraw %}</option>
                    </select>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="checkIn" class="block text-sm font-medium text-gray-700">Check-in Date:</label>
                        <input type="date" id="checkIn" v-model="newReservation.checkIn" required
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="checkOut" class="block text-sm font-medium text-gray-700">Check-out Date:</label>
                        <input type="date" id="checkOut" v-model="newReservation.checkOut" required
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                </div>
                <button type="submit" :disabled="submittingReservation"
                        class="w-full inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50">
                    {% raw %}{{ submittingReservation ? 'Booking...' : 'Book Room' }}{% endraw %}
                </button>
                <div v-if="reservationMessage" :class="{'text-green-600': !reservationError, 'text-red-600': reservationError}" class="mt-2 text-center">{{ reservationMessage }}</div>
            </form>
        </section>

        <!-- Reservation List -->
        <section class="bg-white p-6 rounded shadow">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Current Reservations</h2>
            <div v-if="loadingReservations" class="text-center text-gray-500">Loading reservations...</div>
            <div v-else-if="reservations.length === 0" class="text-center text-gray-500">No reservations found.</div>
            <ul v-else class="space-y-3">
                <li v-for="res in reservations" :key="res.id" class="p-4 border rounded bg-gray-50 flex justify-between items-center">
                    <div>
                        <span class="font-medium">{% raw %}{{ res.guestName }}{% endraw %}</span> - Room ID: {% raw %}{{ res.roomId }}{% endraw %}
                        <span class="block text-sm text-gray-600">Dates: {% raw %}{{ res.checkIn }}{% endraw %} to {% raw %}{{ res.checkOut }}{% endraw %}</span>
                        <span class="block text-xs text-gray-400">ID: {% raw %}{{ res.id }}{% endraw %}</span>
                    </div>
                    <button @click="cancelReservation(res.id)" :disabled="cancellingReservation === res.id"
                            class="ml-4 py-1 px-3 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50">
                        {% raw %}{{ cancellingReservation === res.id ? 'Cancelling...' : 'Cancel' }}{% endraw %}
                    </button>
                </li>
            </ul>
             <div v-if="errorReservations" class="text-red-500 mt-2">{{ errorReservations }}</div>
        </section>

    </div>

    <!-- Link to the static JavaScript file -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
